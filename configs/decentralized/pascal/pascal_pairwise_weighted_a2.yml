# Pascal Context A2: Pairwise - With Early Stopping & LR Scheduling
# Multi-task learning with pairwise task combinations on Pascal Context
#
# Same configuration as NYU V2 A2, adapted for Pascal Context
#
# Tasks (based on Maninis et al. CVPR 2019):
#   - Semantic Segmentation (59 classes) - ORIGINAL annotations
#   - Human Parts Segmentation (15 classes) - ORIGINAL annotations
#   - Edge Detection - ORIGINAL annotations
#
# All three tasks use original annotations for highest quality.
# Dataset: 4,998 train + 5,105 val images
# Download: https://data.vision.ee.ethz.ch/kmaninis/share/MTL/PASCAL_MT.tgz

general:
  title: "pascal_a2_pairwise"
  seed: 42
  description: "Pascal A2: Pairwise multi-task with early stopping and LR scheduler"

data:
  dataset: "pascal_context"
  root_dir: "./data/pascal_context"
  dataset_fraction: 1.0

setup:
  num_clients: 6
  n_neighbors: 3
  alpha: 0.5
  aggregate_heads: true
  task_threshold: 0.1
  aggregation_method: "weighted"

  # Pairwise task combinations (all original annotations)
  task_weights_per_client:
    # C0: segmentation-dominant + human_parts
    - segmentation: 0.7
      human_parts: 0.3
      edge: 0.0

    # C1: segmentation-dominant + edge
    - segmentation: 0.7
      human_parts: 0.0
      edge: 0.3

    # C2: human_parts-dominant + segmentation
    - segmentation: 0.3
      human_parts: 0.7
      edge: 0.0

    # C3: human_parts-dominant + edge
    - segmentation: 0.0
      human_parts: 0.7
      edge: 0.3

    # C4: edge-dominant + segmentation
    - segmentation: 0.3
      human_parts: 0.0
      edge: 0.7

    # C5: edge-dominant + human_parts
    - segmentation: 0.0
      human_parts: 0.3
      edge: 0.7

training:
  num_rounds: 50
  local_epochs: 5
  batch_size: 8
  learning_rate: 0.001
  optimizer: "adam"

  # Learning rate scheduler
  lr_scheduler:
    enabled: true
    type: "cosine"
    min_lr: 0.0001
    warmup_rounds: 3

  # Early stopping - More conservative due to high variance
  early_stopping:
    enabled: true
    patience: 10  # Longer patience for multi-task
    min_delta: 0.002  # More sensitive threshold
    restore_best_weights: true
    verbose: true
    mode: "min"

model:
  backbone: "resnet50"
  pretrained: true
  num_seg_classes: 59  # Semantic segmentation: 59 classes
  num_human_parts_classes: 6  # 6 body parts (head, torso, larm, rarm, lleg, rleg)
  # Edge detection: binary output (1 channel)
  out_size: [288, 384]

output:
  output_dir: "./results/pascal_context/a2_pairwise"
  save_checkpoints: true
  checkpoint_frequency: 5
  log_frequency: 1
  save_metrics_every_round: true

# Expected results:
# - Test if pairwise multi-task learning benefits transfer from NYU V2
# - Expected to outperform A1 if multi-task synergy exists
# - Training should stop at Round 25-30
